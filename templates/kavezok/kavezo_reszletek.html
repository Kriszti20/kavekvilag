<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ kavezo.nev }} részletei</title>
    <style>
        body {
            background-color: #1f4037;
            color: white;
            font-family: 'Georgia', serif;
            margin: 0;
        }
        header {
            background-color: #1c2824;
            padding: 13px 30px 13px 32px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: white;
            box-shadow: 0 2px 10px #0001;
        }
        
        .logo {
            font-size: 2rem;
            font-family: 'Georgia', serif;
            font-weight: bold;
            letter-spacing: 1px;
            color: #ffe29e;
        }
        
        nav {
            display: flex;
            align-items: center;
            gap: 22px;
        }
        
        nav a {
            color: #fff;
            text-decoration: none;
            font-size: 1.02rem;
            font-weight: bold;
            padding: 4px 8px;
            border-radius: 6px;
            transition: background 0.18s, color 0.2s;
        }
        

        
        .user-info {
            margin-left: 26px;
            color: #fee8b2;
            font-weight: 600;
            font-size: 1.01rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .logout-form {
            display: inline;
            margin-left: 8px;
        }
        .logout-form button {
            background: none;
            border: none;
            color: #ffe2aa;
            text-decoration: underline;
            cursor: pointer;
            font-size: 1rem;
            font-family: inherit;
            padding: 2px 5px;
            border-radius: 3px;
            transition: color 0.18s, background 0.15s;
        }
        .logout-form button:hover {
            background: #ffe8cd;
            color: #a77040;
        }
        
        .container {
            max-width: 800px;
            margin: 50px auto;
            background-color: #2e443e;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        
        h1 {
            color: #F9BE7C;
            text-align: center;
        }
        
        p {
            color: #ddd;
            font-size: 1.1rem;
            margin: 10px 0;
        }
        
        a {
            color: #F9BE7C;
            text-decoration: none;
            font-weight: bold;
        }
        
        nav a:hover {
            color: #cf9775;
        }
        
        .kedvezmenyek-doboz {
            display: flex;
            flex-direction: column;
            gap: 16px;
            margin-bottom: 16px;
        }
        .kedvezmeny-kartya {
            background: #213831;
            border-radius: 10px;
            box-shadow: 0 2px 10px #0002;
            padding: 12px 18px;
            color: #f9ecd7;
        }
        .kedvezmeny-fej {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            margin-bottom: 2px;
        }
        .kedvezmeny-nev {
            font-weight: 700;
            font-size: 1.1em;
            color: #ffe29e;
        }
        .kedvezmeny-szazalek {
            font-weight: bold;
            font-size: 1.2em;
            background: #ffac43;
            color: #213831;
            padding: 2px 8px;
            border-radius: 8px;
        }
        .kedvezmeny-idoszak {
            font-size: 0.85em;
            color: #e3c87a;
            margin-bottom: 4px;
            margin-left: 2px;
        }
        .kedvezmeny-leiras {
            margin-top: 6px;
            color: #fffbe8;
            font-style: italic;
            font-size: 0.98em;
        }
        .termekek-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 22px;
            max-width: 750px;
            margin: 30px auto 36px auto;
        }
        
        .termek-kartya {
            background: #253932;
            border-radius: 13px;
            box-shadow: 0 3px 12px #00000016;
            padding: 18px 13px 16px 16px;
            min-height: unset;
            border: 1.5px solid #3e524030;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            transition: box-shadow 0.15s, border-color 0.15s, transform 0.16s;
        }
        .termek-kartya:hover {
            box-shadow: 0 7px 24px #18484027;
            border-color: #f9be7ccc;
            transform: scale(1.022);
            z-index: 2;
        }
        
        .termek-fejlec {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            margin-bottom: 5px;
            gap: 9px;
        }
        .termek-nev {
            color: #ffe29e;
            font-size: 1.09em;
            font-weight: 700;
            letter-spacing: 0.2px;
        }
        .termek-ar {
            color: #f9be7c;
            background: #ffe29e1a;
            font-weight: bold;
            font-size: 1em;
            border-radius: 8px;
            padding: 2px 9px 2px 10px;
            margin-left: 5px;
            margin-bottom: -2px;
        }
        
        .termek-leiras {
            color: #fffad7;
            font-size: 0.99em;
            margin-bottom: 14px;
            margin-top: 2px;
        }
        
        .termek-kartya-lab {
            margin-top: auto;
            width: 100%;
            display: flex;
            justify-content: flex-end;
        }
        
        .kartya-btn {
            background: linear-gradient(90deg, #f9be7c 65%, #ffe29e 100%);
            color: #234634;
            font-weight: 600;
            font-size: 0.99em;
            padding: 7px 17px;
            border-radius: 6px;
            border: none;
            margin-top: 0;
            box-shadow: 0 1px 4px #f9be7c15;
            transition: background 0.16s, box-shadow 0.16s;
        }
        .kartya-btn:hover {
            cursor: pointer;
        }
        
        .kartya-link {
            color: #f9be7c;
            text-decoration: underline;
            font-weight: bold;
            margin-left: 5px;
            transition: color 0.15s;
            font-size: 0.92em;
        }
        .kartya-link:hover {
            color: #fff6d6;
        }
        .kosar-btn {
            background: #dfa26f;
            color: #133929;
            border: none;
            padding: 8px 18px;
            border-radius: 6px;
            font-size: 1em;
            margin-top: 10px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.18s;
        }
        .kosar-btn:hover {
            background: #c88b5f;
        }
            .ertekeles-szulo {
                max-width: 800px;
                margin: 0 auto 24px auto;
                padding: 0 8px;
            }
            .ertekeles-lista {
                display: flex;
                flex-wrap: wrap;
                gap: 12px;
                justify-content: flex-start;
            }
            .ertekeles-box {
                background: #223a32;
                border-radius: 11px;
                box-shadow: 0 1.5px 6px rgba(0,0,0,0.08);
                padding: 14px 17px 11px 17px;
                margin-bottom: 6px;
                display: flex;
                flex-direction: column;
                max-width: 215px;
                min-width: 170px;
                width: 100%;
                min-height: 60px;
                font-size: 0.98em;
            }
            .ertekeles-fejlec {
                display: flex; 
                align-items: center;
                gap: 7px;
                margin-bottom: 2px;
                flex-wrap: wrap;
            }
            .ertekeles-felhasznalo {
                font-weight: bold;
                font-size: 0.99em;
                color: #ffe79a;
                margin-right: 3px;
                white-space: nowrap;
            }
            .csillagok {
                color: gold;
                font-size: 1.09em;
                letter-spacing: -1.4px;
                margin-top: 1px;
            }
            .ertekeles-megjegyzes {
                font-style: italic;
                color: #e0e0e0;
                margin-top: 1px;
                font-size: 0.93em;
            }
            .ertekeles-box span[style*="color:#a6b485"] {
                font-size: 0.81em;
                margin-left: 8px;
                white-space: nowrap;
            }
            
            .ertekeles-form-box {
                background: #223a32;
                border-radius: 12px;
                box-shadow: 0 2px 9px rgba(0,0,0,0.11);
                padding: 21px 17px 18px 17px;
                max-width: 370px;
                margin: 30px auto 0 auto;
            }
            .ertekeles-form-box h2 {
                color: #fff9db;
                margin-bottom: 14px;
                font-size: 1.18em;
            }
            .ertekeles-form-box label {
                display: block;
                margin-bottom: 4px;
                color: #ffe79a;
                font-weight: bold;
                font-size: 1em;
            }
            .ertekeles-form-box select,
            .ertekeles-form-box textarea {
                width: 100%;
                padding: 6px 8px;
                border-radius: 5px;
                border: 1px solid #d6a95c;
                margin-bottom: 9px;
                background: #284a41;
                color: #fff8cd;
                font-size: 1em;
            }
            .ertekeles-form-box button {
                padding: 7px 13px;
                background: linear-gradient(90deg,#ffcd70 60%, #ffb553 100%);
                color: #433800;
                border: none;
                border-radius: 5px;
                font-weight: bold;
                cursor: pointer;
                font-size: 1em;
                margin-top: 5px;
            }
            
            @media (max-width: 900px) {
                .ertekeles-szulo { max-width: 96vw; }
                .ertekeles-box { max-width: 38vw; }
            }
            @media (max-width: 650px) {
                .ertekeles-lista { flex-direction: column; align-items: center; }
                .ertekeles-box { max-width: 96vw; }
            }
        .kedvezmenyek-doboz {
            max-width: 520px;
            margin: 28px auto;
        }

    </style>
</head>
<body>
    <header>
        <div class="logo">Kávék világa</div>
        <nav>
            <a href="/">Kezdőlap</a>
            <a href="{% url 'kavezok:kereso' %}">Kávézók</a>
            <nav>
                <!-- egyéb menüpontok -->
                <a href="{% url 'kavezok:kosar_megjelenitese' %}">Kosár</a>
            </nav>
            <a href="{% url 'kavezok:foglalas_letrehozas' %}">Foglalás</a>
            {% if user.is_authenticated %}
                <div class="user-info">
                    <a href="{% url 'kavezok:profil' %}"><span>Bejelentkezve: {{ user.username }}</span></a>
                    <form method="post" action="{% url 'kavezok:logout' %}" class="logout-form">
                        {% csrf_token %}
                        <button type="submit">Kijelentkezés</button>
                    </form>
                </div>
            {% else %}
                <a href="{% url 'kavezok:bejelentkezes' %}">Bejelentkezés</a>
            {% endif %}
        </nav>
    </header>
    <div class="container">
        <h1>{{ kavezo.nev }}</h1>
        <p><strong>Cím:</strong> {{ kavezo.cim }}</p>
        <div id="google-plusz-reszletek"><!-- ide jön a Google-adat --></div>
        <!-- Debug kiíratás: -->
        <br>
        <a href="{% url 'kavezok:kereso' %}">Vissza a kereséshez</a>
    </div>

    {% if kavezo.google_place_id %}
    <script>
    document.addEventListener('DOMContentLoaded', function(){
        console.log('Script indul, place_id=', "{{ kavezo.google_place_id }}");
        fetch('/api/google_place_details/?place_id={{ kavezo.google_place_id }}')
          .then(res => res.json())
          .then(data => {
            console.log('Google adatok:', data);
            if (data.result) {
                let html = "";
                if (data.result.rating) {
                  html += `<p><b>Google értékelés:</b> ⭐ ${data.result.rating} (${data.result.user_ratings_total} értékelés)</p>`;
                }
                if (data.result.international_phone_number) {
                  html += `<p><b>Telefon:</b> ${data.result.international_phone_number}</p>`;
                }
                if (data.result.website) {
                  html += `<p><b>Weboldal:</b> <a href="${data.result.website}" target="_blank">${data.result.website}</a></p>`;
                }
                if (data.result.url) {
                  html += `<p><a href="${data.result.url}" target="_blank">Megnyitás Google Maps-ben</a></p>`;
                }
                if (data.result.price_level !== undefined) {
                  const szintek = ["ingyenes", "olcsó", "közepes", "drága", "nagyon drága"];
                  html += `<p><b>Google árszint:</b> ${szintek[data.result.price_level] || data.result.price_level}</p>`;
                }
                if (data.result.reviews) {
                  html += "<p><b>Legutóbbi Google-vélemények:</b><br>";
                  data.result.reviews.slice(0,2).forEach(r => {
                    html += `<i>${r.author_name}</i> (${r.rating}⭐): "${r.text.substring(0,100)}..."<br>`;
                  });
                  html += "</p>";
                }
                document.getElementById("google-plusz-reszletek").innerHTML += html;
              } else {
              document.getElementById("google-plusz-reszletek").innerHTML = "<em>Nincs Google-infó elérhető.</em>";
            }
          })
          .catch(err => {
            document.getElementById("google-plusz-reszletek").innerHTML = "<em>(Hiba a Google-lekérdezésnél.)</em>";
          });
    });
    </script>
{% endif %}
<h2>Elérhető termékek</h2>
<div class="termekek-grid">
    {% for termek in termekek %}
        <div class="termek-kartya">
            <div class="termek-fejlec">
                <span class="termek-nev">{{ termek.nev }}</span>
                <span class="termek-ar">{{ termek.ar|floatformat:0 }} Ft</span>
            </div>
            <div class="termek-leiras">
                {{ termek.leiras|default:"Nincs részletes leírás." }}
            </div>
            <div class="termek-kartya-lab">
                {% if user.is_authenticated %}
                    <form method="post" action="{% url 'kavezok:kosar_hozzaad' termek.id %}">
                        {% csrf_token %}
                        <button type="submit" class="kartya-btn">Kosárba teszem</button>
                    </form>
                {% else %}
                    <div class="termek-login-info">
                        <span style="color:#F9BE7C;">Belépés után rakhatod kosárba!</span>
                        <a href="{% url 'kavezok:bejelentkezes' %}" class="kartya-link"><b>Bejelentkezés</b></a>
                    </div>
                {% endif %}
            </div>
        </div>
    {% empty %}
        <div style="color:#ffe29e;text-align:center;">Jelenleg nincsenek elérhető termékek.</div>
    {% endfor %}
</div>


<div>
    <h3>Felhasználói értékelések</h3>
    
    <div class="ertekeles-szulo">
        <h3 style="margin-bottom:16px;">Felhasználói értékelések</h3>
        <div class="ertekeles-lista">
          {% for ertekeles in ertekelesek %}
            <div class="ertekeles-box">
                <div class="ertekeles-fejlec">
                    <span class="ertekeles-felhasznalo">
                      {{ ertekeles.felhasznalo.username|default:"Vendég" }}
                    </span>
                    <span class="csillagok">
                      {% for i in "12345"|make_list %}
                        {% if ertekeles.pontszam >= i|add:'0' %}
                          ★
                        {% else %}
                          <span style="color:#5a6344;">★</span>
                        {% endif %}
                      {% endfor %}
                    </span>
                    <span style="color:#ffe79a; font-size:0.93em; margin-left:7px;">{{ ertekeles.pontszam }}/5</span>
                    <span style="color:#a6b485; font-size:0.83em; margin-left:9px;">
                      {{ ertekeles.datum|date:"Y.m.d H:i" }}
                    </span>
                </div>
                <div class="ertekeles-megjegyzes">{{ ertekeles.megjegyzes }}</div>
            </div>
          {% empty %}
            <i style="color:#fff8cd;">Még nincsenek értékelések.</i>
          {% endfor %}
        </div>
    </div>
    
    <div class="ertekeles-form-box">
        {% if user.is_authenticated %}
            <h2>Értékelés hozzáadása</h2>
            <form method="post">
                {% csrf_token %}
                {{ form.pontszam.label_tag }}
                {{ form.pontszam }}
                {{ form.megjegyzes.label_tag }}
                {{ form.megjegyzes }}
                <button type="submit">Küldés</button>
            </form>
        {% else %}
            <p style="color:#ffe79a;font-weight:bold">
                Kérlek, <a href="{% url 'kavezok:bejelentkezes' %}" style="color:#ffcd70;">jelentkezz be</a>, hogy értékelhess!
            </p>
        {% endif %}
    </div>
    <h2>Kedvezmények</h2>
    {% if kedvezmenyek %}
        <div class="kedvezmenyek-doboz">
            {% for kedvezmeny in kedvezmenyek %}
                <div class="kedvezmeny-kartya">
                    <div class="kedvezmeny-fej">
                        <span class="kedvezmeny-nev">{{ kedvezmeny.nev }}</span>
                        <span class="kedvezmeny-szazalek">-{{ kedvezmeny.ar_szazalek }}%</span>
                    </div>
                    <div class="kedvezmeny-idoszak">
                        <small>Érvényes: {{ kedvezmeny.ervenyes_tol|date:"Y.m.d" }} – {{ kedvezmeny.ervenyes_ig|date:"Y.m.d" }}</small>
                    </div>
                    {% if kedvezmeny.leiras %}
                        <div class="kedvezmeny-leiras">{{ kedvezmeny.leiras }}</div>
                    {% endif %}
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p>Nincs aktív kedvezmény ennél a kávézónál.</p>
    {% endif %}
    
</ul>
</body>
</html>
